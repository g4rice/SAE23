<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Instant Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FEUILLE DE STYLE PRINCIPALE -->
  <link rel="stylesheet" href="styles.css">

  <!-- LEAFLET CSS (si vous lâ€™utilisez) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  >

  <!-- CHART.JS (si vous lâ€™utilisez) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app-container">
    <!-- =======================================================
         HEADER : logo centrÃ© + bouton sombre/clair en haut Ã  droite
         ======================================================= -->
    <header>
      <img src="img/logo.png" alt="Instant Weather" class="logo">
      <button
        id="toggle-theme"
        class="btn-icon"
        aria-label="Basculer thÃ¨me sombre / clair"
      >
        ğŸŒ™
      </button>
    </header>

    <!-- ========== SECTION RECHERCHE (FORMULAIRE) ========== -->
    <section id="search-section">
      <h2>Recherche de la mÃ©tÃ©o</h2>
      <form id="weatherForm">
        <!-- =============================================
             Conteneur â€œRechercheâ€ + bouton gÃ©olocalisation
             ============================================= -->
        <div class="form-group search-with-geo">
          <label for="ville">Recherche&nbsp;:</label>
          <div class="input-geo-container">
            <input
              type="text"
              id="ville"
              placeholder="Ex : Caen ou 14000"
              aria-required="true"
            >
            <button
              type="button"
              id="geo-btn"
              class="btn-secondary geo-button"
              title="Utiliser ma position"
            >
              ğŸ“
            </button>
          </div>
        </div>
        <!-- =================================================== -->

        <!-- Champ Â« Nombre de jours Â» -->
        <div class="form-group">
          <label for="jours">Nombre de jours&nbsp;:</label>
          <div class="slider-container">
            <input
              type="range"
              id="jours"
              min="1"
              max="7"
              value="1"
              oninput="this.nextElementSibling.innerText = this.value + (this.value > 1 ? ' jours' : ' jour')"
            >
            <span class="slider-value">1 jour</span>
          </div>
        </div>

        <!-- Fieldset Â« Informations supplÃ©mentaires Â» -->
        <fieldset class="infos-sup">
          <legend>Informations supplÃ©mentaires&nbsp;:</legend>
          <label>
            <input type="checkbox" name="infos" value="latitude">
            Latitude
          </label>
          <label>
            <input type="checkbox" name="infos" value="longitude">
            Longitude
          </label>
          <label>
            <input type="checkbox" name="infos" value="pluie">
            Cumul de pluie (mm)
          </label>
          <label>
            <input type="checkbox" name="infos" value="vent">
            Vent moyen (km/h)
          </label>
          <label>
            <input type="checkbox" name="infos" value="direction">
            Direction du vent (Â°)
          </label>
        </fieldset>

        <!-- ====== BOUTON Â« Afficher la mÃ©tÃ©o Â» CENTRÃ‰ SOUS INFOS-SUP ====== -->
        <div class="center-button">
          <button type="submit" class="btn-primary">Afficher la mÃ©tÃ©o</button>
        </div>
        <!-- =============================================================== -->

        <!-- ====== BOUTON Â« Passer en Â°F Â» CENTRÃ‰ SOUS Â« Afficher la mÃ©tÃ©o Â» ====== -->
        <div class="center-button">
          <button type="button" id="toggle-units" class="btn-primary">
            Passer en Â°F
          </button>
        </div>
        <!-- ==================================================================== -->

        <!-- ====== BOUTON Â« RÃ©initialiser Â» CENTRÃ‰ SOUS Â« Passer en Â°F Â» ====== -->
        <div class="center-button">
          <button type="button" id="reset-btn" class="btn-secondary">
            RÃ©initialiser
          </button>
        </div>
        <!-- =========================================================================== -->
      </form>
    </section>

    <!-- ========== SECTION CARTE LEAFLET ========== -->
    <section id="map-section">
      <!-- On peut conserver le h2 dynamique â€œ#commune-nameâ€ qui affiche le nom de la ville. -->
      <h2 id="commune-name">â€ </h2>

      <!-- Conteneur pour afficher latitude/longitude si sÃ©lectionnÃ© -->
      <div id="coords"></div>

      <!-- Loader lors du fetch mÃ©tÃ©o -->
      <div id="loader" class="hidden">
        <p>Chargement en coursâ€¦</p>
      </div>

      <!-- Conteneur carte Leaflet -->
      <div id="map-container">
        <div
          id="mapid"
          class="hidden"
          role="application"
          aria-label="Carte de localisation"
        ></div>
      </div>
    </section>

    <!-- ========== SECTION PRÃ‰VISIONS MÃ‰TÃ‰O ========== -->
    <section id="forecast-section">
      <h2>PrÃ©visions mÃ©tÃ©o</h2>
      <div id="forecast-container">
        <!-- Les forecast-cards seront injectÃ©es ici par recupinfometeo.js -->
      </div>
    </section>

    <!-- ========== SECTION GRAPHIQUE (Chart.js) ========== -->
    <section id="chart-section">
      <!-- Passage de h3 Ã  h2 pour faire un titre de section valide -->
      <h2 class="chart-title">Graphique des tempÃ©ratures pour plusieurs jours</h2>
      <canvas id="tempChart"></canvas>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer>Â© 2025 Instant Weather â€“ Tous droits rÃ©servÃ©s</footer>
  </div>
  <!-- /#app-container -->

  <!-- ========== SCRIPTS ========== -->
  <!-- 1) Leaflet JS (si vous utilisez une carte) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- 2) Vos scripts mÃ©tier -->
  <script src="recupinfometeo.js"></script>
  <script src="recupinfoville.js"></script>

  <!-- 3) Script principal pour RÃ©initialiser / Toggle Â°C-Â°F / Toggle thÃ¨me -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ************** BOUTON RÃ‰INITIALISER **************
      const resetBtn = document.getElementById("reset-btn");
      resetBtn.addEventListener("click", () => {
        // 1) RÃ©initialiser le formulaire et dÃ©cocher toutes les cases
        const form = document.getElementById("weatherForm");
        form.reset();

        // 2) RÃ©initialiser le slider Ã  1 et son label
        const slider = document.getElementById("jours");
        slider.value = 1;
        slider.nextElementSibling.innerText = "1 jour";

        // 3) Vider le champ de recherche (input id="ville")
        document.getElementById("ville").value = "";

        // 4) Vider #commune-name et #coords
        document.getElementById("commune-name").innerText = "";
        document.getElementById("coords").innerHTML = "";

        // 5) Masquer la carte et dÃ©truire lâ€™ancienne instance Leaflet
        if (window._leafletMap) {
          window._leafletMap.remove();
          window._leafletMap = null;
        }
        document.getElementById("mapid").classList.add("hidden");

        // 6) Vider les prÃ©visions
        document.getElementById("forecast-container").innerHTML = "";

        // 7) DÃ©truire le graphique si prÃ©sent
        if (typeof tempChart !== "undefined" && tempChart) {
          tempChart.destroy();
          tempChart = null;
        }
        //    Vider le canvas du graphique
        const chartCanvas = document.getElementById("tempChart");
        if (chartCanvas) {
          chartCanvas
            .getContext("2d")
            .clearRect(0, 0, chartCanvas.width, chartCanvas.height);
        }

        // 8) Re-cacher la section graphique
        const chartSect = document.getElementById("chart-section");
        if (chartSect) {
          chartSect.style.display = "none";
        }

        // 9) RÃ©initialiser le bouton Â« Passer en Â°F Â» Ã  son Ã©tat par dÃ©faut
        const btnToggleUnits = document.getElementById("toggle-units");
        btnToggleUnits.textContent = "Passer en Â°F";
        window.currentUnit = "C";
      });

      // ************** BOUTON TOGGLE Â°C / Â°F **************
      const btnToggleUnits = document.getElementById("toggle-units");
      btnToggleUnits.addEventListener("click", () => {
        // Inverser la variable globale currentUnit
        window.currentUnit = window.currentUnit === "C" ? "F" : "C";

        // Mettre Ã  jour le texte du bouton
        if (window.currentUnit === "C") {
          btnToggleUnits.textContent = "Passer en Â°F";
        } else {
          btnToggleUnits.textContent = "Passer en Â°C";
        }

        // Si on a dÃ©jÃ  une derniÃ¨re position (lastLat, lastLon, lastNbJours), on relance fetchMeteo
        if (window.lastLat && window.lastLon && window.lastNbJours) {
          const infosCheckboxes = document.querySelectorAll(
            'input[name="infos"]:checked'
          );
          const infos = Array.from(infosCheckboxes).map((cb) => cb.value);
          fetchMeteo(
            window.lastLat,
            window.lastLon,
            infos,
            window.lastNbJours
          );
        }
      });

      // ************** BOUTON BASCULER THÃˆME (dark-mode) **************
      const btnToggleTheme = document.getElementById("toggle-theme");
      // Au chargement de la page, on lit localStorage (clÃ© Â« theme Â»)
      const storedTheme = localStorage.getItem("theme") || "light";
      if (storedTheme === "dark") {
        document.body.classList.add("dark-mode");
        btnToggleTheme.textContent = "â˜€ï¸";
      } else {
        document.body.classList.remove("dark-mode");
        btnToggleTheme.textContent = "ğŸŒ™";
      }

      btnToggleTheme.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        btnToggleTheme.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    });
  </script>
</body>
</html>
