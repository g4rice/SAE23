<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Instant Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FEUILLE DE STYLE PRINCIPALE -->
  <link rel="stylesheet" href="styles.css">

  <!-- LEAFLET CSS (si vous l‚Äôutilisez) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  >

  <!-- CHART.JS (si vous l‚Äôutilisez) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app-container">
    <!-- =======================================================
         HEADER : logo centr√© + bouton sombre/clair en haut √† droite
         ======================================================= -->
    <header>
      <img src="img/logo.png" alt="Instant Weather" class="logo">
      <button
        id="toggle-theme"
        class="btn-icon"
        aria-label="Basculer th√®me sombre / clair"
      >
        üåô
      </button>
    </header>

    <!-- ========== SECTION RECHERCHE (FORMULAIRE) ========== -->
    <section id="search-section">
      <h2>Recherche de la m√©t√©o</h2>
      <form id="weatherForm">
        <!-- =============================================
             Conteneur ‚ÄúRecherche‚Äù + bouton g√©olocalisation
             ============================================= -->
        <div class="form-group search-with-geo">
          <label for="ville">Recherche&nbsp;:</label>
          <div class="input-geo-container">
            <input
              type="text"
              id="ville"
              placeholder="Ex : Caen ou 14000"
              aria-required="true"
            >
            <button
              type="button"
              id="geo-btn"
              class="btn-secondary geo-button"
              title="Utiliser ma position"
            >
              üìç
            </button>
          </div>
        </div>
        <!-- =================================================== -->

        <!-- Champ ¬´ Nombre de jours ¬ª -->
        <div class="form-group">
          <label for="jours">Nombre de jours&nbsp;:</label>
          <div class="slider-container">
            <input
              type="range"
              id="jours"
              min="1"
              max="7"
              value="1"
              oninput="this.nextElementSibling.innerText = this.value + (this.value > 1 ? ' jours' : ' jour')"
            >
            <span class="slider-value">1 jour</span>
          </div>
        </div>

        <!-- Fieldset ¬´ Informations suppl√©mentaires ¬ª -->
        <fieldset class="infos-sup">
          <legend>Informations suppl√©mentaires&nbsp;:</legend>
          <label>
            <input type="checkbox" name="infos" value="latitude">
            Latitude
          </label>
          <label>
            <input type="checkbox" name="infos" value="longitude">
            Longitude
          </label>
          <label>
            <input type="checkbox" name="infos" value="pluie">
            Cumul de pluie (mm)
          </label>
          <label>
            <input type="checkbox" name="infos" value="vent">
            Vent moyen (km/h)
          </label>
          <label>
            <input type="checkbox" name="infos" value="direction">
            Direction du vent (¬∞)
          </label>
        </fieldset>

        <!-- ====== BOUTON ¬´ Afficher la m√©t√©o ¬ª CENTR√â SOUS INFOS-SUP ====== -->
        <div class="center-button">
          <button type="submit" class="btn-primary">Afficher la m√©t√©o</button>
        </div>
        <!-- =============================================================== -->

        <!-- ====== BOUTON ¬´ Passer en ¬∞F ¬ª CENTR√â SOUS ¬´ Afficher la m√©t√©o ¬ª ====== -->
        <div class="center-button">
          <button type="button" id="toggle-units" class="btn-primary">
            Passer en ¬∞F
          </button>
        </div>
        <!-- ==================================================================== -->

        <!-- ====== BOUTON ¬´ R√©initialiser ¬ª CENTR√â SOUS ¬´ Passer en ¬∞F ¬ª ====== -->
        <div class="center-button">
          <button type="button" id="reset-btn" class="btn-secondary">
            R√©initialiser
          </button>
        </div>
        <!-- =========================================================================== -->
      </form>
    </section>

    <!-- ========== SECTION CARTE LEAFLET ========== -->
    <section id="map-section">
      <!-- On peut conserver le h2 dynamique ‚Äú#commune-name‚Äù qui affiche le nom de la ville. -->
      <h2 id="commune-name">&nbsp;</h2>

      <!-- Conteneur pour afficher latitude/longitude si s√©lectionn√© -->
      <div id="coords"></div>

      <!-- Loader lors du fetch m√©t√©o -->
      <div id="loader" class="hidden">
        <p>Chargement en cours‚Ä¶</p>
      </div>

      <!-- Conteneur carte Leaflet -->
      <div id="map-container">
        <div
          id="mapid"
          class="hidden"
          role="application"
          aria-label="Carte de localisation"
        ></div>
      </div>
    </section>

    <!-- ========== SECTION PR√âVISIONS M√âT√âO ========== -->
    <section id="forecast-section">
      <h2>Pr√©visions m√©t√©o</h2>
      <div id="forecast-container">
        <!-- Les forecast-cards seront inject√©es ici par recupinfometeo.js -->
      </div>
    </section>

    <!-- ========== SECTION GRAPHIQUE (Chart.js) ========== -->
    <section id="chart-section">
      <!-- Passage de h3 √† h2 pour faire un titre de section valide -->
      <h2 class="chart-title">Graphique des temp√©ratures pour plusieurs jours</h2>
      <canvas id="tempChart"></canvas>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer>¬© 2025 Instant Weather ‚Äì Tous droits r√©serv√©s</footer>
  </div>
  <!-- /#app-container -->

  <!-- ========== SCRIPTS ========== -->
  <!-- 1) Leaflet JS (si vous utilisez une carte) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- 2) Vos scripts m√©tier -->
  <script src="recupinfometeo.js"></script>
  <script src="recupinfoville.js"></script>

  <!-- 3) Script principal pour R√©initialiser / Toggle ¬∞C-¬∞F / Toggle th√®me -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ************** BOUTON R√âINITIALISER **************
      const resetBtn = document.getElementById("reset-btn");
      resetBtn.addEventListener("click", () => {
        // 1) R√©initialiser le formulaire et d√©cocher toutes les cases
        const form = document.getElementById("weatherForm");
        form.reset();

        // 2) R√©initialiser le slider √† 1 et son label
        const slider = document.getElementById("jours");
        slider.value = 1;
        slider.nextElementSibling.innerText = "1 jour";

        // 3) Vider le champ de recherche (input id="ville")
        document.getElementById("ville").value = "";

        // 4) Vider #commune-name et #coords
        document.getElementById("commune-name").innerText = "";
        document.getElementById("coords").innerHTML = "";

        // 5) Masquer la carte et d√©truire l‚Äôancienne instance Leaflet
        if (window._leafletMap) {
          window._leafletMap.remove();
          window._leafletMap = null;
        }
        document.getElementById("mapid").classList.add("hidden");

        // 6) Vider les pr√©visions
        document.getElementById("forecast-container").innerHTML = "";

        // 7) D√©truire le graphique si pr√©sent
        if (typeof tempChart !== "undefined" && tempChart) {
          tempChart.destroy();
          tempChart = null;
        }
        //    Vider le canvas du graphique
        const chartCanvas = document.getElementById("tempChart");
        if (chartCanvas) {
          chartCanvas
            .getContext("2d")
            .clearRect(0, 0, chartCanvas.width, chartCanvas.height);
        }

        // 8) Re-cacher la section graphique
        const chartSect = document.getElementById("chart-section");
        if (chartSect) {
          chartSect.style.display = "none";
        }

        // 9) R√©initialiser le bouton ¬´ Passer en ¬∞F ¬ª √† son √©tat par d√©faut
        const btnToggleUnits = document.getElementById("toggle-units");
        btnToggleUnits.textContent = "Passer en ¬∞F";
        window.currentUnit = "C";
      });

      // ************** BOUTON TOGGLE ¬∞C / ¬∞F **************
      const btnToggleUnits = document.getElementById("toggle-units");
      btnToggleUnits.addEventListener("click", () => {
        // Inverser la variable globale currentUnit
        window.currentUnit = window.currentUnit === "C" ? "F" : "C";

        // Mettre √† jour le texte du bouton
        if (window.currentUnit === "C") {
          btnToggleUnits.textContent = "Passer en ¬∞F";
        } else {
          btnToggleUnits.textContent = "Passer en ¬∞C";
        }

        // Si on a d√©j√† une derni√®re position (lastLat, lastLon, lastNbJours), on relance fetchMeteo
        if (window.lastLat && window.lastLon && window.lastNbJours) {
          const infosCheckboxes = document.querySelectorAll(
            'input[name="infos"]:checked'
          );
          const infos = Array.from(infosCheckboxes).map((cb) => cb.value);
          fetchMeteo(
            window.lastLat,
            window.lastLon,
            infos,
            window.lastNbJours
          );
        }
      });

      // ************** BOUTON BASCULER TH√àME (dark-mode) **************
      const btnToggleTheme = document.getElementById("toggle-theme");
      // Au chargement de la page, on lit localStorage (cl√© ¬´ theme ¬ª)
      const storedTheme = localStorage.getItem("theme") || "light";
      if (storedTheme === "dark") {
        document.body.classList.add("dark-mode");
        btnToggleTheme.textContent = "‚òÄÔ∏è";
      } else {
        document.body.classList.remove("dark-mode");
        btnToggleTheme.textContent = "üåô";
      }

      btnToggleTheme.addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
        const isDark = document.body.classList.contains("dark-mode");
        btnToggleTheme.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    });
  </script>
</body>
</html>
